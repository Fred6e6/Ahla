<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إدخال الأصناف | Ahla</title>

<!-- حماية الصفحة -->
<script src="js/roleGuard.js"></script>

<style>
body {
  font-family: Tahoma;
  background: #f5f5f5;
  padding: 20px;
}

h2 {
  text-align: center;
}

table {
  width: 100%;
  background: white;
  border-collapse: collapse;
}

th {
  background: #9ccbc7;
  padding: 10px;
}

td {
  padding: 8px;
  text-align: center;
}

input {
  width: 100%;
  padding: 6px;
}

input[disabled] {
  background: #e9e9e9;
}

button {
  padding: 6px 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.add { background: #6c757d; }
.edit { background: #ffc107; }
.delete { background: #dc3545; color: white; }
.logout { background: black; color: white; float: left; }
</style>
</head>

<body>

<button class="logout" onclick="logout()">خروج</button>

<h2>إدخال الأصناف</h2>

<table>
<thead>
<tr>
  <th>رقم الصنف</th>
  <th>اسم الصنف</th>
  <th>الوحدة</th>
  <th>الكمية</th>
  <th>السعر</th>
  <th>الإجمالي</th>
  <th>إجراء</th>
</tr>
</thead>
<tbody>
<tr>
  <td><input id="code"></td>
  <td><input disabled></td>
  <td><input value="حبة" disabled></td>
  <td><input id="qty" type="number"></td>
  <td><input id="price" type="number"></td>
  <td><input id="total" disabled></td>
  <td><button class="add" onclick="addItem()">إضافة</button></td>
</tr>
</tbody>
</table>

<br>

<table id="dataTable">
<thead>
<tr>
  <th>#</th>
  <th>رقم الصنف</th>
  <th>الوحدة</th>
  <th>الكمية</th>
  <th>السعر</th>
  <th>الإجمالي</th>
  <th>إجراء</th>
</tr>
</thead>
<tbody></tbody>
</table>

<script>
/* تعريف العناصر أولًا */
const codeInput  = document.getElementById("code");
const qtyInput   = document.getElementById("qty");
const priceInput = document.getElementById("price");
const totalInput = document.getElementById("total");

/* حساب تلقائي */
qtyInput.addEventListener("input", calcTotal);
priceInput.addEventListener("input", calcTotal);

function calcTotal() {
  const qty = Number(qtyInput.value);
  const price = Number(priceInput.value);

  if (qty > 0 && price > 0) {
    totalInput.value = qty * price;
  } else {
    totalInput.value = "";
  }
}

/* البيانات */
let data = JSON.parse(localStorage.getItem("ahla_data")) || [];
render();

/* إضافة */
function addItem() {
  if (!codeInput.value || !qtyInput.value || !priceInput.value) {
    alert("يرجى تعبئة رقم الصنف والكمية والسعر");
    return;
  }

  data.push({
    code: codeInput.value,
    unit: "حبة",
    qty: Number(qtyInput.value),
    price: Number(priceInput.value),
    total: Number(totalInput.value)
  });

  localStorage.setItem("ahla_data", JSON.stringify(data));
  clearInputs();
  render();
}

/* عرض الجدول */
function render() {
  const tbody = document.querySelector("#dataTable tbody");
  tbody.innerHTML = "";

  data.forEach((item, i) => {
    const row = tbody.insertRow();
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${item.code}</td>
      <td>${item.unit}</td>
      <td>${item.qty}</td>
      <td>${item.price}</td>
      <td>${item.total}</td>
      <td>
        <button class="edit" onclick="editItem(${i})">تعديل</button>
        <button class="delete" onclick="deleteItem(${i})">حذف</button>
      </td>
    `;
  });
}

/* تعديل */
function editItem(i) {
  const item = data[i];
  codeInput.value = item.code;
  qtyInput.value = item.qty;
  priceInput.value = item.price;
  totalInput.value = item.total;

  data.splice(i, 1);
  localStorage.setItem("ahla_data", JSON.stringify(data));
  render();
}

/* حذف */
function deleteItem(i) {
  if (!confirm("هل تريد الحذف؟")) return;
  data.splice(i, 1);
  localStorage.setItem("ahla_data", JSON.stringify(data));
  render();
}

/* مسح */
function clearInputs() {
  codeInput.value = "";
  qtyInput.value = "";
  priceInput.value = "";
  totalInput.value = "";
}
</script>

<script src="js/auth.js"></script>

</body>
</html>
