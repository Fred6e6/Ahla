<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>البيانات المرسلة | Ahla</title>
<script src="js/roleGuard.js"></script>

<style>
  body{font-family:Tahoma;background:#f5f5f5;padding:20px}
  h2{text-align:center;margin:0 0 12px}
  table{width:100%;background:#fff;border-collapse:collapse}
  th,td{border:1px solid #ddd;padding:8px;text-align:center}
  th{background:#9ccbc7}
  img.thumb{width:46px;height:46px;object-fit:cover;border-radius:6px;margin:2px;border:1px solid #ccc}
  .bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
  button{padding:7px 12px;border:none;border-radius:6px;cursor:pointer}
  .back{background:#6c757d;color:#fff}
</style>
</head>

<body>

<div class="bar">
  <button class="back" type="button" onclick="location.href='add.html'">رجوع للإدخال</button>
  <div>آخر دفعة مرسلة: <b id="bid"></b></div>
</div>

<h2>البيانات المرسلة</h2>

<table id="t">
  <thead>
    <tr>
      <th>#</th>
      <th>المستخدم</th>
      <th>رقم الصنف</th>
      <th>الوحدة</th>
      <th>الكمية</th>
      <th>السعر</th>
      <th>الإجمالي</th>
      <th>صور هذا الصنف</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
  const KEY_BATCHES = "ahla_batches";
  const KEY_LAST_SENT = "ahla_last_sent_batch";

  const lastId = localStorage.getItem(KEY_LAST_SENT);
  document.getElementById("bid").textContent = lastId || "-";

  const batches = JSON.parse(localStorage.getItem(KEY_BATCHES)) || [];
  const batch = batches.find(b => b.batchId === lastId);

  const tbody = document.querySelector("#t tbody");
  tbody.innerHTML = "";

  if (!batch) {
    tbody.innerHTML = `<tr><td colspan="8">لا توجد دفعة مرسلة للعرض</td></tr>`;
  } else {
    batch.items.forEach((it, i) => {
      const imgs = (it.images || []).map(src => `<img class="thumb" src="${src}" />`).join("");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i+1}</td>
        <td>${it.user || ""}</td>
        <td>${it.code}</td>
        <td>${it.unit}</td>
        <td>${it.qty}</td>
        <td>${it.price}</td>
        <td>${it.total}</td>
        <td>${imgs}</td>
      `;
      tbody.appendChild(tr);
    });
  }
</script>

</body>
</html>
