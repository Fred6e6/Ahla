<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© | Ahla</title>
<script src="js/roleGuard.js"></script>

<style>
body{font-family:Tahoma;background:#f5f5f5;padding:20px}
nav{background:#343a40;padding:10px;margin-bottom:15px}
nav button{background:#6c757d;color:#fff;border:none;padding:7px 12px;margin:3px;border-radius:5px;cursor:pointer}
nav .logout{background:#dc3545}
table{width:100%;background:#fff;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#9ccbc7}
img{width:64px;margin:4px;border:1px solid #ccc;border-radius:6px}
</style>
</head>

<body>

<nav>
  <button onclick="location.href='add.html'">â• Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
  <button onclick="history.back()">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
  <button class="logout" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
</nav>

<h2>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h2>

<div id="out"></div>

<script>
const user = localStorage.getItem("user");
const batches = JSON.parse(localStorage.getItem("ahla_batches")) || [];
const mine = batches.filter(b => b.user === user);
const last = mine[mine.length - 1];

if (!last) {
  out.textContent = "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø³Ù„Ø©";
} else {
  let h = `<p><b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${last.date}</p>`;
  h += `<table>
          <tr>
            <th>#</th><th>Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
            <th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
          </tr>`;
  last.items.forEach((i, idx) => {
    h += `<tr>
            <td>${idx + 1}</td>
            <td>${i.code}</td>
            <td>${i.qty}</td>
            <td>${i.price}</td>
            <td>${i.total}</td>
          </tr>`;
  });
  h += `</table><h3>ØµÙˆØ± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h3>`;
  last.images.forEach(img => h += `<img src="${img}">`);
  out.innerHTML = h;
}
</script>

<script src="js/auth.js"></script>
</body>
</html>
