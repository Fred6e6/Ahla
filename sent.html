<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø© | Ahla</title>
<script src="js/roleGuard.js"></script>

<style>
body{font-family:Tahoma;background:#f5f5f5;padding:20px}
nav{background:#222;padding:10px;margin-bottom:15px;display:flex;gap:8px;flex-wrap:wrap}
nav button{background:#6c757d;color:#fff;border:none;padding:7px 12px;border-radius:6px;cursor:pointer}
nav .logout{background:#dc3545}
table{width:100%;background:#fff;border-collapse:collapse}
th,td{border:1px solid #ddd;padding:8px;text-align:center}
th{background:#9ccbc7}
img{width:70px;margin:4px;border:1px solid #ccc;border-radius:6px}
.small{font-size:12px;color:#444}
</style>
</head>

<body>

<nav>
  <button type="button" onclick="location.href='add.html'">â• Ø¥Ø¯Ø®Ø§Ù„</button>
  <button type="button" onclick="location.href='sent.html'">ğŸ“¤ Ø§Ù„Ù…Ø±Ø³Ù„Ø©</button>
  <button type="button" class="logout" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
</nav>

<h2>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±Ø³Ù„Ø©</h2>
<div id="out"></div>

<script>
const user = localStorage.getItem("user");
const batches = JSON.parse(localStorage.getItem("ahla_batches")) || [];

// Ø¢Ø®Ø± Ø¯ÙØ¹Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
const mine = batches.filter(b => b.user === user);
const last = mine[mine.length - 1];

const out = document.getElementById("out");

if (!last) {
  out.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø±Ø³Ù„Ø©.</p>";
} else {
  let h = `
    <p class="small">
      <b>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</b> ${last.user} â€”
      <b>Ø§Ù„ØªØ§Ø±ÙŠØ®:</b> ${last.date} â€”
      <b>Ø§Ù„Ù…Ø¹Ø±Ù‘Ù:</b> ${last.id}
    </p>
    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ø±Ù‚Ù… Ø§Ù„ØµÙ†Ù</th>
          <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
          <th>Ø§Ù„Ø³Ø¹Ø±</th>
          <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
        </tr>
      </thead>
      <tbody>
  `;

  last.items.forEach((i, idx) => {
    h += `
      <tr>
        <td>${idx + 1}</td>
        <td>${i.code}</td>
        <td>${i.qty}</td>
        <td>${i.price}</td>
        <td>${i.total}</td>
      </tr>
    `;
  });

  h += `</tbody></table><h3>ØµÙˆØ± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„</h3>`;

  (last.images || []).forEach(img => {
    h += `<img src="${img}">`;
  });

  out.innerHTML = h;
}
</script>

<script src="js/auth.js"></script>
</body>
</html>
