<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة تحكم المدير | Ahla</title>

<!-- حماية الصفحة -->
<script src="js/roleGuard.js"></script>

<style>
body {
  font-family: Tahoma;
  background: #f2f2f2;
  padding: 20px;
}

h2 {
  text-align: center;
}

table {
  width: 100%;
  background: white;
  border-collapse: collapse;
}

th {
  background: #343a40;
  color: white;
  padding: 10px;
}

td {
  padding: 8px;
  text-align: center;
}

button {
  padding: 6px 10px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  margin: 3px;
}

.export { background: #198754; color: white; }
.clear { background: #dc3545; color: white; }
.delete { background: #ff6b6b; color: white; }
.logout { background: black; color: white; float: left; }
</style>
</head>

<body>

<button class="logout" onclick="logout()">خروج</button>

<h2>لوحة تحكم المدير</h2>

<div style="margin-bottom:10px">
  <button class="export" onclick="exportExcel()">تحميل Excel</button>
  <button class="clear" onclick="clearAll()">مسح جميع البيانات</button>
</div>

<table id="adminTable">
<thead>
<tr>
  <th>#</th>
  <th>رقم الصنف</th>
  <th>الوحدة</th>
  <th>الكمية</th>
  <th>السعر</th>
  <th>الإجمالي</th>
  <th>إجراء</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- مكتبة Excel -->
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

<script>
if (localStorage.getItem("role") !== "admin") {
  alert("غير مصرح لك بالدخول");
  window.location.href = "index.html";
}

let data = JSON.parse(localStorage.getItem("ahla_data")) || [];
render();

function render() {
  const tbody = document.querySelector("#adminTable tbody");
  tbody.innerHTML = "";

  data.forEach((item, i) => {
    const row = tbody.insertRow();
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${item.code}</td>
      <td>${item.unit}</td>
      <td>${item.qty}</td>
      <td>${item.price}</td>
      <td>${item.total}</td>
      <td>
        <button class="delete" onclick="deleteItem(${i})">حذف</button>
      </td>
    `;
  });
}

function deleteItem(i) {
  if (!confirm("هل تريد حذف هذا السطر؟")) return;
  data.splice(i, 1);
  localStorage.setItem("ahla_data", JSON.stringify(data));
  render();
}

function clearAll() {
  if (!confirm("سيتم حذف جميع البيانات، هل أنت متأكد؟")) return;
  localStorage.removeItem("ahla_data");
  data = [];
  render();
}

function exportExcel() {
  if (data.length === 0) {
    alert("لا توجد بيانات");
    return;
  }

  const ws = XLSX.utils.json_to_sheet(data);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "Ahla Data");
  XLSX.writeFile(wb, "ahla-data.xlsx");
}
</script>

<script src="js/auth.js"></script>

</body>
</html>
